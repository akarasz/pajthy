(this.webpackJsonppajthy=this.webpackJsonppajthy||[]).push([[0],{32:function(e,t,n){"use strict";n.r(t);var c=n(1),s=n.n(c),i=n(16),r=n.n(i),o=n(4),a=n(9),u=n(2),l=n(0),j=function(e){var t=e.text,n=e.className,c=e.disabled,s=e.onClick,i=["big"];return n&&i.push(n),Object(l.jsx)("button",{onClick:s,className:i.join(" "),disabled:c,children:t})},d="api.pajthy.akarasz.me",b="https://"+d,f=function(e){var t=e.text,n=e.choices,c=Object(u.f)();return Object(l.jsx)(j,{text:t,onClick:function(){!function(e,t){fetch(b,{method:"POST",body:JSON.stringify(e)}).then((function(e){if(201!==e.status)throw e;null===t||void 0===t||t(e.headers.get("location"))}))}(n,(function(e){return c.push(e+"/control")}))}})},h=function(){return Object(l.jsxs)("div",{className:"content",children:[Object(l.jsx)(f,{text:"Fibonacci",choices:["1","2","3","5","8","13","?"]}),Object(l.jsx)(f,{text:"T-Shirt",choices:["XS","S","M","L","XL","XXL","?"]}),Object(l.jsx)(f,{text:"\u270b",choices:["\ud83d\udc4d","\ud83d\udc4c","\ud83e\udd37","\ud83d\udc4e","\ud83d\udd95"]})]})},O=n(15),x=n(18),m=n.n(x),v=function(){var e="https://pajthy.com/"+Object(u.g)().sessionId;return Object(l.jsxs)("div",{className:"share",children:[Object(l.jsx)("div",{className:"link",children:e}),Object(l.jsx)("button",{onClick:function(){navigator.clipboard.writeText(e)},children:"Copy"})]})},p=function(e){var t=e.open,n=e.hasVotes,c=Object(u.g)().sessionId;return t?Object(l.jsx)(j,{text:"STAHP!",className:"danger",onClick:function(){return function(e,t){return fetch(b+"/"+e+"/control/stop",{method:"PATCH"}).then((function(e){if(202!==e.status)throw e;null===t||void 0===t||t()}))}(c)}}):n?Object(l.jsx)(j,{text:"Reset",onClick:function(){return function(e,t){return fetch(b+"/"+e+"/control/reset",{method:"PATCH"}).then((function(e){if(202!==e.status)throw e;null===t||void 0===t||t()}))}(c)}}):Object(l.jsx)(j,{text:"Begin voting!",onClick:function(){return function(e,t){return fetch(b+"/"+e+"/control/start",{method:"PATCH"}).then((function(e){if(202!==e.status)throw e;null===t||void 0===t||t()}))}(c)}})},g=function(e){var t=e.participants,n=e.votes,c=e.inProgress;return 0===t.length?null:Object(l.jsx)("table",{className:"votes",children:Object(l.jsx)("tbody",{children:t.map((function(e,t){return Object(l.jsx)(C,{name:e,vote:n[e],inProgress:c},t)}))})})},k=function(e){var t=e.votes,n=Object.keys(t),c=Object.values(t).map((function(e){return parseInt(e)}));if(n.length<=0)return null;if(c.filter((function(e){return isNaN(e)})).length>0)return null;var s=c.reduce((function(e,t){return e+t}))/c.length,i=m()(c);return Object(l.jsx)("table",{className:"aggregate",children:Object(l.jsxs)("tbody",{children:[Object(l.jsxs)("tr",{children:[Object(l.jsx)("td",{children:"Average"}),Object(l.jsx)("td",{children:s.toFixed(2)})]}),Object(l.jsxs)("tr",{children:[Object(l.jsx)("td",{children:"Median"}),Object(l.jsx)("td",{children:i.toFixed(2)})]})]})})},C=function(e){var t=e.name,n=e.vote,c=e.inProgress,s=c&&n;return Object(l.jsxs)("tr",{className:s?"already-voted":null,children:[Object(l.jsxs)("td",{children:[t," ",Object(l.jsx)(N,{name:t})]}),Object(l.jsx)("td",{children:c?null:n})]})},N=function(e){var t=e.name,n=Object(u.g)().sessionId;return Object(l.jsx)("span",{className:"kick",onClick:function(){return function(e,t,n){return fetch(b+"/"+e+"/control/kick",{method:"PATCH",body:t}).then((function(e){if(204!==e.status)throw e;null===n||void 0===n||n()}))}(n,t)},children:"(X)"})},w=function(){var e=Object(c.useState)(null),t=Object(o.a)(e,2),n=t[0],s=t[1],i=Object(u.g)().sessionId,r=Object(c.useRef)(null),a=Object(c.useContext)(T).setAnimated;if(Object(c.useEffect)((function(){!function(e,t){fetch(b+"/"+e+"/control",{method:"GET"}).then((function(e){return Promise.all([e.status,e.json()])})).then((function(e){var n=Object(o.a)(e,2),c=n[0],s=n[1];if(200!==c)throw s;null===t||void 0===t||t(s)}))}(i,(function(e){s(e),a(e.Open)}))}),[i,a]),Object(c.useEffect)((function(){return r.current=new WebSocket("wss://"+d+"/"+i+"/control/ws"),function(){r.current.close()}}),[i,a]),Object(c.useEffect)((function(){r.current&&(r.current.onmessage=function(e){var t=JSON.parse(e.data);switch(t.Kind){case"enabled":a(!0);break;case"disabled":case"reset":a(!1)}s((function(e){return Object(O.a)(Object(O.a)({},e),t.Data)}))})}),[i,a]),!n)return null;var j=n.Participants||[],f=n.Votes||{};return Object(l.jsxs)("div",{className:"admin content",children:[Object(l.jsx)(v,{}),Object(l.jsx)(p,{open:n.Open,hasVotes:Object.keys(f).length>0}),Object(l.jsx)(g,{participants:j,votes:f,inProgress:n.Open}),n.Open?null:Object(l.jsx)(k,{votes:f})]})},y=function(e){var t=e.name,n=e.value,c=e.autoFocus,s=e.onChange,i=e.onEnter;return Object(l.jsxs)("div",{className:"pair",children:[Object(l.jsx)("label",{htmlFor:t,children:t}),Object(l.jsx)("input",{id:t,type:"text",autoFocus:c,value:n,onChange:s,onKeyPress:function(e){"Enter"===e.key&&(null===i||void 0===i||i())}})]})},S=function(e){var t=e.defaultValue,n=e.onClickJoin,s=Object(c.useState)(t),i=Object(o.a)(s,2),r=i[0],a=i[1],u=function(){n(r)};return Object(l.jsxs)("div",{className:"content",children:[Object(l.jsx)(y,{name:"Name",value:r,onChange:function(e){a(e.target.value)},onEnter:u,autoFocus:!0}),Object(l.jsx)(j,{text:"Join",onClick:u})]})},P=function(e){var t=e.name,n=Object(c.useState)([]),s=Object(o.a)(n,2),i=s[0],r=s[1],a=Object(c.useState)(null),j=Object(o.a)(a,2),f=j[0],h=j[1],O=Object(c.useState)(!1),x=Object(o.a)(O,2),m=x[0],v=x[1],p=Object(u.g)().sessionId,g=Object(c.useRef)(null),k=Object(c.useState)(!1),C=Object(o.a)(k,2),N=C[0],w=C[1],y=Object(c.useContext)(T).setAnimated;return Object(c.useEffect)((function(){!function(e,t){fetch(b+"/"+e,{method:"GET"}).then((function(e){return Promise.all([e.status,e.json()])})).then((function(e){var n=Object(o.a)(e,2),c=n[0],s=n[1];if(200!==c)throw s;null===t||void 0===t||t(s)}))}(p,(function(e){r(e.Choices),v(e.Open),y(e.Open)}))}),[p,y,N]),Object(c.useEffect)((function(){var e=new WebSocket("wss://"+d+"/"+p+"/ws");return g.current=e,function(){e.close()}}),[p,N]),Object(c.useEffect)((function(){g.current&&(g.current.onmessage=function(e){var t=JSON.parse(e.data);"enabled"===t.Kind?(v(!0),y(!0),h(null)):"disabled"===t.Kind?(v(!1),y(!1)):"reset"===t.Kind&&(v(!1),y(!1),h(null))},g.current.onclose=function(){g.current=null,w((function(e){return!e}))})}),[p,y,N]),Object(l.jsx)("div",{className:"content",children:i.map((function(e,n){return Object(l.jsx)(I,{choice:e,name:t,enabled:m,selected:f===e,onClick:h},n)}))})},I=function(e){var t=e.name,n=e.choice,c=e.enabled,s=e.selected,i=e.onClick,r=Object(u.g)().sessionId,o=function(e){!function(e,t,n,c){fetch(b+"/"+e,{method:"PUT",body:JSON.stringify({Participant:t,Choice:n})}).then((function(e){if(202!==e.status)throw e;null===c||void 0===c||c()}))}(r,t,e,(function(){return i(e)}))};return Object(l.jsx)(j,{className:s?"selected":null,text:n,disabled:!c,onClick:function(){return o(n)}})},E=function(){var e=Object(c.useState)(null),t=Object(o.a)(e,2),n=t[0],s=t[1],i=Object(u.g)().sessionId,r=function(e){window.localStorage.setItem("name",e),s(e)};if(null===n){return Object(l.jsx)(S,{onClickJoin:function(e){!function(e,t,n,c){fetch(b+"/"+e+"/join",{method:"PUT",body:t}).then((function(e){if(201===e.status)null===n||void 0===n||n();else{if(409!==e.status)throw e;null===c||void 0===c||c()}}))}(i,e,(function(){return r(e)}),(function(){return r(e)}))},defaultValue:n||window.localStorage.getItem("name")||""})}return Object(l.jsx)(P,{name:n})},T=Object(c.createContext)({}),A=function(e){var t=["logo"];return e.animate&&t.push("animate"),Object(l.jsxs)("header",{children:[Object(l.jsx)("div",{className:t.join(" ")}),Object(l.jsxs)("div",{className:"title",children:[Object(l.jsx)("h1",{children:Object(l.jsx)(a.b,{to:"/",children:"Pajthy"})}),Object(l.jsx)("p",{className:"subtitle",children:"easy voting for your remote scrum ceremonies"})]})]})},J=function(){var e=Object(c.useState)(!1),t=Object(o.a)(e,2),n=t[0],s=t[1];return Object(l.jsx)(T.Provider,{value:{animated:n,setAnimated:s},children:Object(l.jsx)("div",{className:"pajthy",children:Object(l.jsxs)(a.a,{children:[Object(l.jsx)(A,{animate:n}),Object(l.jsx)("div",{className:"countdown"}),Object(l.jsxs)(u.c,{children:[Object(l.jsx)(u.a,{exact:!0,path:"/",children:Object(l.jsx)(h,{})}),Object(l.jsx)(u.a,{path:"/:sessionId/control",children:Object(l.jsx)(w,{})}),Object(l.jsx)(u.a,{path:"/:sessionId",children:Object(l.jsx)(E,{})})]})]})})})};r.a.render(Object(l.jsx)(s.a.StrictMode,{children:Object(l.jsx)(J,{})}),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.38ea27da.chunk.js.map