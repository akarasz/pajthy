(this.webpackJsonppajthy=this.webpackJsonppajthy||[]).push([[0],{31:function(t,e,n){"use strict";n.r(e);var c=n(0),s=n.n(c),o=n(16),i=n.n(o),r=n(4),a=n(9),u=n(2),l=n(1),j=function(t){var e=t.text,n=t.className,c=t.disabled,s=t.onClick,o=["big"];return n&&o.push(n),Object(l.jsx)("button",{onClick:s,className:o.join(" "),disabled:c,children:e})},b="api.pajthy.akarasz.me",d="https://"+b,f=function(t){var e=t.text,n=t.choices,c=Object(u.f)();return Object(l.jsx)(j,{text:e,onClick:function(){!function(t,e){fetch(d,{method:"POST",body:JSON.stringify(t)}).then((function(t){if(201!==t.status)throw t;null===e||void 0===e||e(t.headers.get("location"))}))}(n,(function(t){return c.push(t+"/control")}))}})},h=function(){return Object(l.jsxs)("div",{className:"content",children:[Object(l.jsx)(f,{text:"Fibonacci",choices:["1","2","3","5","8","13","?"]}),Object(l.jsx)(f,{text:"T-Shirt",choices:["S","M","L","?"]}),Object(l.jsx)(f,{text:"\u270b",choices:["\ud83d\udc4d","\ud83d\udc4c","\ud83e\udd37","\ud83d\udc4e","\ud83d\udd95"]})]})},O=n(15),x=function(){var t="https://pajthy.com/"+Object(u.g)().sessionId;return Object(l.jsxs)("div",{className:"share",children:[Object(l.jsx)("div",{className:"link",children:t}),Object(l.jsx)("button",{onClick:function(){navigator.clipboard.writeText(t)},children:"Copy"})]})},m=function(t){var e=t.open,n=t.hasVotes,c=Object(u.g)().sessionId;return e?Object(l.jsx)(j,{text:"STAHP!",className:"danger",onClick:function(){return function(t,e){return fetch(d+"/"+t+"/control/stop",{method:"PATCH"}).then((function(t){if(202!==t.status)throw t;null===e||void 0===e||e()}))}(c)}}):n?Object(l.jsx)(j,{text:"Reset",onClick:function(){return function(t,e){return fetch(d+"/"+t+"/control/reset",{method:"PATCH"}).then((function(t){if(202!==t.status)throw t;null===e||void 0===e||e()}))}(c)}}):Object(l.jsx)(j,{text:"Begin voting!",onClick:function(){return function(t,e){return fetch(d+"/"+t+"/control/start",{method:"PATCH"}).then((function(t){if(202!==t.status)throw t;null===e||void 0===e||e()}))}(c)}})},v=function(t){var e=t.participants,n=t.votes,c=t.inProgress;return 0===e.length?null:Object(l.jsx)("table",{className:"votes",children:Object(l.jsx)("tbody",{children:e.map((function(t,e){return Object(l.jsx)(p,{name:t,vote:n[t],inProgress:c},e)}))})})},p=function(t){var e=t.name,n=t.vote,c=t.inProgress,s=c&&n;return Object(l.jsxs)("tr",{className:s?"already-voted":null,children:[Object(l.jsxs)("td",{children:[e," ",Object(l.jsx)(g,{name:e})]}),Object(l.jsx)("td",{children:c?null:n})]})},g=function(t){var e=t.name,n=Object(u.g)().sessionId;return Object(l.jsx)("span",{className:"kick",onClick:function(){return function(t,e,n){return fetch(d+"/"+t+"/control/kick",{method:"PATCH",body:e}).then((function(t){if(204!==t.status)throw t;null===n||void 0===n||n()}))}(n,e)},children:"(X)"})},k=function(){var t=Object(c.useState)(null),e=Object(r.a)(t,2),n=e[0],s=e[1],o=Object(u.g)().sessionId,i=Object(c.useRef)(null),a=Object(c.useContext)(P).setAnimated;if(Object(c.useEffect)((function(){!function(t,e){fetch(d+"/"+t+"/control",{method:"GET"}).then((function(t){return Promise.all([t.status,t.json()])})).then((function(t){var n=Object(r.a)(t,2),c=n[0],s=n[1];if(200!==c)throw s;null===e||void 0===e||e(s)}))}(o,(function(t){s(t),a(t.Open)}))}),[o,a]),Object(c.useEffect)((function(){return i.current=new WebSocket("wss://"+b+"/"+o+"/control/ws"),function(){i.current.close()}}),[o,a]),Object(c.useEffect)((function(){i.current&&(i.current.onmessage=function(t){var e=JSON.parse(t.data);switch(e.Kind){case"enabled":a(!0);break;case"disabled":case"reset":a(!1)}s((function(t){return Object(O.a)(Object(O.a)({},t),e.Data)}))})}),[o,a]),!n)return null;var j=n.Participants||[],f=n.Votes||{};return Object(l.jsxs)("div",{className:"admin content",children:[Object(l.jsx)(x,{}),Object(l.jsx)(m,{open:n.Open,hasVotes:Object.keys(f).length>0}),Object(l.jsx)(v,{participants:j,votes:f,inProgress:n.Open})]})},C=function(t){var e=t.name,n=t.value,c=t.autoFocus,s=t.onChange,o=t.onEnter;return Object(l.jsxs)("div",{className:"pair",children:[Object(l.jsx)("label",{htmlFor:e,children:e}),Object(l.jsx)("input",{id:e,type:"text",autoFocus:c,value:n,onChange:s,onKeyPress:function(t){"Enter"===t.key&&(null===o||void 0===o||o())}})]})},w=function(t){var e=t.defaultValue,n=t.onClickJoin,s=Object(c.useState)(e),o=Object(r.a)(s,2),i=o[0],a=o[1],u=function(){n(i)};return Object(l.jsxs)("div",{className:"content",children:[Object(l.jsx)(C,{name:"Name",value:i,onChange:function(t){a(t.target.value)},onEnter:u,autoFocus:!0}),Object(l.jsx)(j,{text:"Join",onClick:u})]})},N=function(t){var e=t.name,n=Object(c.useState)([]),s=Object(r.a)(n,2),o=s[0],i=s[1],a=Object(c.useState)(null),j=Object(r.a)(a,2),f=j[0],h=j[1],O=Object(c.useState)(!1),x=Object(r.a)(O,2),m=x[0],v=x[1],p=Object(u.g)().sessionId,g=Object(c.useRef)(null),k=Object(c.useState)(!1),C=Object(r.a)(k,2),w=C[0],N=C[1],S=Object(c.useContext)(P).setAnimated;return Object(c.useEffect)((function(){!function(t,e){fetch(d+"/"+t,{method:"GET"}).then((function(t){return Promise.all([t.status,t.json()])})).then((function(t){var n=Object(r.a)(t,2),c=n[0],s=n[1];if(200!==c)throw s;null===e||void 0===e||e(s)}))}(p,(function(t){i(t.Choices),v(t.Open),S(t.Open)}))}),[p,S,w]),Object(c.useEffect)((function(){var t=new WebSocket("wss://"+b+"/"+p+"/ws");return g.current=t,function(){t.close()}}),[p,w]),Object(c.useEffect)((function(){g.current&&(g.current.onmessage=function(t){var e=JSON.parse(t.data);"enabled"===e.Kind?(v(!0),S(!0),h(null)):"disabled"===e.Kind?(v(!1),S(!1)):"reset"===e.Kind&&(v(!1),S(!1),h(null))},g.current.onclose=function(){g.current=null,N((function(t){return!t}))})}),[p,S,w]),Object(l.jsx)("div",{className:"content",children:o.map((function(t,n){return Object(l.jsx)(y,{choice:t,name:e,enabled:m,selected:f===t,onClick:h},n)}))})},y=function(t){var e=t.name,n=t.choice,c=t.enabled,s=t.selected,o=t.onClick,i=Object(u.g)().sessionId,r=function(t){!function(t,e,n,c){fetch(d+"/"+t,{method:"PUT",body:JSON.stringify({Participant:e,Choice:n})}).then((function(t){if(202!==t.status)throw t;null===c||void 0===c||c()}))}(i,e,t,(function(){return o(t)}))};return Object(l.jsx)(j,{className:s?"selected":null,text:n,disabled:!c,onClick:function(){return r(n)}})},S=function(){var t=Object(c.useState)(null),e=Object(r.a)(t,2),n=e[0],s=e[1],o=Object(u.g)().sessionId,i=function(t){window.localStorage.setItem("name",t),s(t)};if(null===n){return Object(l.jsx)(w,{onClickJoin:function(t){!function(t,e,n,c){fetch(d+"/"+t+"/join",{method:"PUT",body:e}).then((function(t){if(201===t.status)null===n||void 0===n||n();else{if(409!==t.status)throw t;null===c||void 0===c||c()}}))}(o,t,(function(){return i(t)}),(function(){return i(t)}))},defaultValue:n||window.localStorage.getItem("name")||""})}return Object(l.jsx)(N,{name:n})},P=Object(c.createContext)({}),E=function(t){var e=["logo"];return t.animate&&e.push("animate"),Object(l.jsxs)("header",{children:[Object(l.jsx)("div",{className:e.join(" ")}),Object(l.jsxs)("div",{className:"title",children:[Object(l.jsx)("h1",{children:Object(l.jsx)(a.b,{to:"/",children:"Pajthy"})}),Object(l.jsx)("p",{className:"subtitle",children:"easy voting for your remote scrum ceremonies"})]})]})},I=function(){var t=Object(c.useState)(!1),e=Object(r.a)(t,2),n=e[0],s=e[1];return Object(l.jsx)(P.Provider,{value:{animated:n,setAnimated:s},children:Object(l.jsx)("div",{className:"pajthy",children:Object(l.jsxs)(a.a,{children:[Object(l.jsx)(E,{animate:n}),Object(l.jsx)("div",{className:"countdown"}),Object(l.jsxs)(u.c,{children:[Object(l.jsx)(u.a,{exact:!0,path:"/",children:Object(l.jsx)(h,{})}),Object(l.jsx)(u.a,{path:"/:sessionId/control",children:Object(l.jsx)(k,{})}),Object(l.jsx)(u.a,{path:"/:sessionId",children:Object(l.jsx)(S,{})})]})]})})})};i.a.render(Object(l.jsx)(s.a.StrictMode,{children:Object(l.jsx)(I,{})}),document.getElementById("root"))}},[[31,1,2]]]);
//# sourceMappingURL=main.e3e4cfaa.chunk.js.map